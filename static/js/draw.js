/**
 * Created by lyk on 2018/5/10 0010.
 */



// jquery labelauty call
$(".dowebok input").labelauty();



// var testJson = {"time_used": 352, "image_id": "bx2XQ0lMhcSlL39zpJEdcg==", "faces": [{"landmark": {"contour_chin": {"y": 508, "x": 255}, "left_eye_upper_left_quarter": {"y": 302, "x": 168}, "mouth_lower_lip_right_contour1": {"y": 427, "x": 270}, "left_eye_bottom": {"y": 316, "x": 182}, "mouth_lower_lip_right_contour2": {"y": 437, "x": 281}, "contour_left7": {"y": 405, "x": 123}, "contour_left6": {"y": 388, "x": 119}, "contour_left5": {"y": 370, "x": 116}, "contour_left4": {"y": 353, "x": 114}, "contour_left3": {"y": 335, "x": 113}, "contour_left2": {"y": 318, "x": 113}, "contour_left1": {"y": 300, "x": 113}, "left_eye_lower_left_quarter": {"y": 314, "x": 168}, "contour_right1": {"y": 281, "x": 382}, "contour_right3": {"y": 317, "x": 386}, "contour_right2": {"y": 299, "x": 384}, "contour_right5": {"y": 354, "x": 387}, "contour_right4": {"y": 335, "x": 387}, "contour_left9": {"y": 440, "x": 134}, "contour_right6": {"y": 372, "x": 386}, "right_eye_right_corner": {"y": 297, "x": 328}, "nose_bridge1": {"y": 297, "x": 240}, "nose_bridge3": {"y": 339, "x": 243}, "nose_bridge2": {"y": 318, "x": 242}, "right_eyebrow_upper_left_corner": {"y": 263, "x": 265}, "nose_right_contour4": {"y": 382, "x": 272}, "nose_right_contour1": {"y": 308, "x": 262}, "right_eye_left_corner": {"y": 303, "x": 275}, "left_eyebrow_upper_right_corner": {"y": 269, "x": 218}, "left_eyebrow_upper_middle": {"y": 258, "x": 175}, "mouth_lower_lip_right_contour3": {"y": 444, "x": 267}, "nose_left_contour3": {"y": 380, "x": 205}, "mouth_lower_lip_bottom": {"y": 447, "x": 249}, "nose_right_contour2": {"y": 353, "x": 274}, "left_eye_top": {"y": 299, "x": 182}, "nose_left_contour1": {"y": 311, "x": 220}, "mouth_upper_lip_bottom": {"y": 426, "x": 247}, "mouth_upper_lip_left_contour2": {"y": 420, "x": 218}, "mouth_upper_lip_top": {"y": 411, "x": 246}, "mouth_upper_lip_left_contour1": {"y": 409, "x": 234}, "mouth_upper_lip_left_contour4": {"y": 429, "x": 226}, "right_eye_top": {"y": 291, "x": 300}, "right_eye_bottom": {"y": 306, "x": 302}, "right_eyebrow_lower_left_corner": {"y": 274, "x": 267}, "mouth_left_corner": {"y": 434, "x": 205}, "nose_middle_contour": {"y": 390, "x": 246}, "right_eye_lower_right_quarter": {"y": 302, "x": 316}, "right_eyebrow_lower_right_quarter": {"y": 264, "x": 328}, "contour_right9": {"y": 427, "x": 375}, "mouth_right_corner": {"y": 428, "x": 294}, "right_eye_lower_left_quarter": {"y": 305, "x": 288}, "right_eye_center": {"y": 298, "x": 299}, "contour_right13": {"y": 483, "x": 330}, "right_eyebrow_lower_left_quarter": {"y": 267, "x": 287}, "left_eye_pupil": {"y": 307, "x": 183}, "contour_right8": {"y": 409, "x": 381}, "contour_left13": {"y": 491, "x": 181}, "left_eyebrow_lower_right_quarter": {"y": 276, "x": 196}, "left_eye_right_corner": {"y": 311, "x": 208}, "left_eyebrow_lower_right_corner": {"y": 280, "x": 216}, "mouth_upper_lip_left_contour3": {"y": 433, "x": 212}, "left_eyebrow_lower_left_quarter": {"y": 275, "x": 154}, "mouth_lower_lip_left_contour1": {"y": 429, "x": 227}, "mouth_lower_lip_left_contour3": {"y": 446, "x": 232}, "mouth_lower_lip_left_contour2": {"y": 441, "x": 218}, "contour_right7": {"y": 390, "x": 384}, "left_eyebrow_left_corner": {"y": 278, "x": 135}, "nose_tip": {"y": 360, "x": 244}, "right_eyebrow_upper_middle": {"y": 249, "x": 307}, "contour_left8": {"y": 423, "x": 128}, "right_eyebrow_lower_middle": {"y": 264, "x": 308}, "left_eye_center": {"y": 307, "x": 183}, "right_eyebrow_upper_left_quarter": {"y": 254, "x": 284}, "right_eyebrow_right_corner": {"y": 264, "x": 347}, "right_eyebrow_upper_right_quarter": {"y": 250, "x": 329}, "contour_left16": {"y": 508, "x": 235}, "contour_left15": {"y": 505, "x": 216}, "contour_left14": {"y": 499, "x": 198}, "left_eyebrow_upper_right_quarter": {"y": 262, "x": 198}, "contour_left12": {"y": 482, "x": 166}, "contour_left11": {"y": 470, "x": 153}, "contour_left10": {"y": 455, "x": 142}, "left_eyebrow_lower_middle": {"y": 274, "x": 175}, "left_eyebrow_upper_left_quarter": {"y": 262, "x": 152}, "right_eye_upper_right_quarter": {"y": 292, "x": 315}, "nose_right_contour3": {"y": 375, "x": 284}, "mouth_upper_lip_right_contour4": {"y": 426, "x": 270}, "nose_right_contour5": {"y": 385, "x": 260}, "nose_left_contour4": {"y": 385, "x": 218}, "nose_left_contour5": {"y": 387, "x": 232}, "nose_left_contour2": {"y": 357, "x": 213}, "mouth_upper_lip_right_contour1": {"y": 407, "x": 258}, "mouth_upper_lip_right_contour2": {"y": 416, "x": 277}, "mouth_upper_lip_right_contour3": {"y": 428, "x": 287}, "left_eye_left_corner": {"y": 309, "x": 156}, "contour_right15": {"y": 500, "x": 296}, "contour_right14": {"y": 492, "x": 314}, "contour_right16": {"y": 505, "x": 276}, "contour_right11": {"y": 459, "x": 358}, "contour_right10": {"y": 443, "x": 368}, "left_eye_upper_right_quarter": {"y": 302, "x": 197}, "contour_right12": {"y": 472, "x": 345}, "left_eye_lower_right_quarter": {"y": 314, "x": 195}, "mouth_lower_lip_top": {"y": 427, "x": 248}, "right_eye_upper_left_quarter": {"y": 294, "x": 286}, "right_eye_pupil": {"y": 298, "x": 299}}, "attributes": {"emotion": {"neutral": 8.274, "sadness": 0.747, "disgust": 0.002, "anger": 0.002, "surprise": 0.011, "fear": 90.964, "happiness": 0.002}, "beauty": {"female_score": 59.304, "male_score": 54.299}, "gender": {"value": "Male"}, "age": {"value": 22}, "eyestatus": {"left_eye_status": {"normal_glass_eye_open": 99.999, "no_glass_eye_close": 0.0, "occlusion": 0.0, "no_glass_eye_open": 0.001, "normal_glass_eye_close": 0.0, "dark_glasses": 0.0}, "right_eye_status": {"normal_glass_eye_open": 99.998, "no_glass_eye_close": 0.0, "occlusion": 0.0, "no_glass_eye_open": 0.002, "normal_glass_eye_close": 0.0, "dark_glasses": 0.0}}, "glass": {"value": "Normal"}, "skinstatus": {"health": 1.38, "stain": 6.0, "acne": 3.343, "dark_circle": 23.425}, "ethnicity": {"value": "ASIAN"}}, "face_token": "5bed241051e4be0f06d9674229733404", "face_rectangle": {"width": 271, "top": 243, "height": 271, "left": 116}}], "request_id": "1525959292,475725f2-5f6b-421c-90f2-3841a9e9de44"};
var testJson;
var manJson = {"request_id": "1526313302,41137dc1-f19f-4597-a49a-9d566a55dd55", "faces": [{"landmark": {"left_eyebrow_left_corner": {"x": 60, "y": 102}, "nose_left_contour5": {"x": 104, "y": 142}, "nose_left_contour3": {"x": 91, "y": 137}, "contour_right3": {"x": 173, "y": 111}, "nose_right_contour4": {"x": 124, "y": 139}, "mouth_lower_lip_right_contour3": {"x": 128, "y": 175}, "contour_left5": {"x": 53, "y": 136}, "contour_left3": {"x": 51, "y": 118}, "contour_right6": {"x": 173, "y": 137}, "left_eye_upper_right_quarter": {"x": 88, "y": 101}, "right_eye_lower_right_quarter": {"x": 145, "y": 102}, "mouth_lower_lip_left_contour1": {"x": 96, "y": 169}, "mouth_upper_lip_left_contour2": {"x": 93, "y": 157}, "contour_right16": {"x": 128, "y": 212}, "contour_right12": {"x": 156, "y": 189}, "nose_tip": {"x": 111, "y": 133}, "contour_left7": {"x": 56, "y": 154}, "contour_right7": {"x": 172, "y": 147}, "contour_right5": {"x": 173, "y": 128}, "left_eyebrow_lower_right_corner": {"x": 99, "y": 95}, "right_eyebrow_lower_right_quarter": {"x": 153, "y": 93}, "contour_left16": {"x": 107, "y": 213}, "left_eye_top": {"x": 82, "y": 100}, "mouth_lower_lip_right_contour1": {"x": 130, "y": 166}, "contour_left15": {"x": 98, "y": 210}, "nose_bridge2": {"x": 110, "y": 111}, "mouth_upper_lip_left_contour3": {"x": 87, "y": 162}, "contour_left12": {"x": 76, "y": 194}, "right_eye_lower_left_quarter": {"x": 133, "y": 102}, "mouth_left_corner": {"x": 82, "y": 161}, "mouth_lower_lip_bottom": {"x": 114, "y": 179}, "left_eye_left_corner": {"x": 71, "y": 107}, "contour_left10": {"x": 66, "y": 180}, "left_eyebrow_upper_left_quarter": {"x": 67, "y": 93}, "right_eyebrow_upper_left_quarter": {"x": 132, "y": 84}, "left_eyebrow_lower_left_quarter": {"x": 69, "y": 98}, "mouth_upper_lip_right_contour4": {"x": 128, "y": 157}, "contour_left8": {"x": 58, "y": 163}, "contour_left6": {"x": 54, "y": 145}, "left_eye_right_corner": {"x": 93, "y": 105}, "contour_left9": {"x": 62, "y": 172}, "right_eyebrow_lower_middle": {"x": 143, "y": 90}, "contour_left11": {"x": 71, "y": 187}, "contour_left4": {"x": 52, "y": 127}, "left_eye_lower_left_quarter": {"x": 76, "y": 108}, "mouth_lower_lip_left_contour2": {"x": 90, "y": 171}, "right_eye_right_corner": {"x": 150, "y": 101}, "right_eye_top": {"x": 138, "y": 95}, "nose_left_contour4": {"x": 97, "y": 140}, "nose_right_contour5": {"x": 118, "y": 141}, "mouth_upper_lip_right_contour3": {"x": 139, "y": 157}, "left_eyebrow_lower_middle": {"x": 78, "y": 95}, "contour_left14": {"x": 90, "y": 206}, "right_eye_center": {"x": 139, "y": 98}, "contour_right14": {"x": 144, "y": 202}, "contour_right13": {"x": 151, "y": 196}, "left_eyebrow_upper_right_quarter": {"x": 88, "y": 88}, "right_eye_upper_left_quarter": {"x": 132, "y": 97}, "left_eye_pupil": {"x": 82, "y": 103}, "contour_left1": {"x": 51, "y": 100}, "nose_bridge3": {"x": 111, "y": 122}, "contour_right11": {"x": 161, "y": 181}, "left_eye_center": {"x": 82, "y": 103}, "nose_bridge1": {"x": 109, "y": 100}, "right_eye_upper_right_quarter": {"x": 145, "y": 97}, "mouth_upper_lip_bottom": {"x": 112, "y": 159}, "right_eyebrow_upper_right_quarter": {"x": 154, "y": 88}, "mouth_lower_lip_right_contour2": {"x": 137, "y": 167}, "right_eyebrow_upper_left_corner": {"x": 122, "y": 87}, "right_eye_pupil": {"x": 139, "y": 98}, "mouth_upper_lip_top": {"x": 112, "y": 155}, "left_eyebrow_upper_right_corner": {"x": 98, "y": 90}, "contour_left13": {"x": 83, "y": 200}, "contour_right15": {"x": 137, "y": 208}, "nose_middle_contour": {"x": 111, "y": 144}, "mouth_upper_lip_left_contour1": {"x": 105, "y": 155}, "mouth_upper_lip_left_contour4": {"x": 97, "y": 160}, "nose_left_contour1": {"x": 100, "y": 104}, "right_eyebrow_lower_left_corner": {"x": 122, "y": 91}, "right_eyebrow_right_corner": {"x": 162, "y": 96}, "contour_right10": {"x": 165, "y": 173}, "nose_right_contour2": {"x": 125, "y": 125}, "contour_chin": {"x": 117, "y": 213}, "right_eyebrow_lower_left_quarter": {"x": 132, "y": 90}, "right_eye_left_corner": {"x": 128, "y": 101}, "left_eyebrow_lower_right_quarter": {"x": 89, "y": 94}, "left_eye_upper_left_quarter": {"x": 76, "y": 102}, "nose_right_contour3": {"x": 130, "y": 135}, "right_eyebrow_upper_middle": {"x": 144, "y": 84}, "mouth_right_corner": {"x": 143, "y": 156}, "contour_right1": {"x": 171, "y": 92}, "right_eye_bottom": {"x": 139, "y": 103}, "contour_left2": {"x": 51, "y": 109}, "left_eye_bottom": {"x": 82, "y": 108}, "contour_right8": {"x": 171, "y": 156}, "mouth_lower_lip_left_contour3": {"x": 100, "y": 177}, "contour_right9": {"x": 168, "y": 165}, "contour_right2": {"x": 172, "y": 101}, "mouth_lower_lip_top": {"x": 113, "y": 171}, "mouth_upper_lip_right_contour2": {"x": 131, "y": 154}, "left_eye_lower_right_quarter": {"x": 88, "y": 106}, "left_eyebrow_upper_middle": {"x": 77, "y": 89}, "contour_right4": {"x": 173, "y": 119}, "mouth_upper_lip_right_contour1": {"x": 119, "y": 154}, "nose_left_contour2": {"x": 96, "y": 126}, "nose_right_contour1": {"x": 119, "y": 103}}, "attributes": {"age": {"value": 46}, "eyestatus": {"left_eye_status": {"normal_glass_eye_open": 0.679, "no_glass_eye_open": 99.321, "no_glass_eye_close": 0.0, "occlusion": 0.0, "normal_glass_eye_close": 0.0, "dark_glasses": 0.0}, "right_eye_status": {"normal_glass_eye_open": 0.001, "no_glass_eye_open": 99.999, "no_glass_eye_close": 0.0, "occlusion": 0.0, "normal_glass_eye_close": 0.0, "dark_glasses": 0.0}}, "glass": {"value": "None"}, "ethnicity": {"value": "BLACK"}, "gender": {"value": "Male"}, "emotion": {"disgust": 0.001, "anger": 0.0, "surprise": 0.001, "sadness": 0.0, "happiness": 99.997, "neutral": 0.001, "fear": 0.0}, "skinstatus": {"stain": 22.053, "health": 0.29, "dark_circle": 3.341, "acne": 11.372}, "beauty": {"female_score": 73.669, "male_score": 63.845}}, "face_token": "d91dc8c92899a64c73567a564ee697d3", "face_rectangle": {"height": 130, "top": 84, "left": 50, "width": 130}}], "time_used": 245, "image_id": "5CmJuRwDXe7etZx4FCJFnw=="};
var womanJson = {"image_id": "/b43PoSwmnuVoQ/pDkRXVQ==", "faces": [{"face_rectangle": {"width": 127, "height": 127, "top": 64, "left": 32}, "attributes": {"skinstatus": {"dark_circle": 8.897, "stain": 5.227, "health": 57.7, "acne": 9.936}, "ethnicity": {"value": "INDIA"}, "eyestatus": {"left_eye_status": {"dark_glasses": 0.0, "normal_glass_eye_open": 0.027, "no_glass_eye_open": 99.973, "no_glass_eye_close": 0.0, "normal_glass_eye_close": 0.0, "occlusion": 0.0}, "right_eye_status": {"dark_glasses": 0.0, "normal_glass_eye_open": 0.14, "no_glass_eye_open": 99.86, "no_glass_eye_close": 0.0, "normal_glass_eye_close": 0.0, "occlusion": 0.0}}, "gender": {"value": "Female"}, "glass": {"value": "None"}, "emotion": {"neutral": 0.024, "fear": 0.002, "anger": 0.002, "surprise": 0.061, "happiness": 99.827, "sadness": 0.002, "disgust": 0.083}, "age": {"value": 26}, "beauty": {"male_score": 81.954, "female_score": 84.372}}, "face_token": "b41c59090c8235cdb307ae14bc40b8cc", "landmark": {"right_eye_center": {"x": 122, "y": 91}, "contour_right4": {"x": 159, "y": 110}, "mouth_lower_lip_top": {"x": 92, "y": 159}, "mouth_left_corner": {"x": 65, "y": 143}, "contour_left9": {"x": 45, "y": 145}, "right_eyebrow_right_corner": {"x": 147, "y": 77}, "contour_right8": {"x": 150, "y": 142}, "right_eye_lower_right_quarter": {"x": 131, "y": 94}, "right_eyebrow_lower_middle": {"x": 128, "y": 78}, "nose_left_contour3": {"x": 71, "y": 131}, "nose_right_contour1": {"x": 101, "y": 96}, "contour_left10": {"x": 49, "y": 152}, "left_eyebrow_upper_right_quarter": {"x": 68, "y": 75}, "right_eye_lower_left_quarter": {"x": 117, "y": 97}, "mouth_lower_lip_right_contour1": {"x": 109, "y": 155}, "left_eyebrow_lower_right_corner": {"x": 74, "y": 84}, "left_eyebrow_upper_right_corner": {"x": 76, "y": 80}, "left_eye_lower_left_quarter": {"x": 55, "y": 92}, "left_eyebrow_upper_middle": {"x": 60, "y": 71}, "contour_left11": {"x": 54, "y": 159}, "mouth_lower_lip_left_contour2": {"x": 71, "y": 154}, "contour_left12": {"x": 59, "y": 166}, "nose_bridge3": {"x": 91, "y": 122}, "contour_left16": {"x": 82, "y": 189}, "right_eye_right_corner": {"x": 136, "y": 91}, "mouth_lower_lip_right_contour3": {"x": 107, "y": 163}, "right_eye_bottom": {"x": 124, "y": 97}, "mouth_right_corner": {"x": 123, "y": 143}, "mouth_upper_lip_bottom": {"x": 92, "y": 150}, "right_eyebrow_upper_middle": {"x": 127, "y": 72}, "left_eyebrow_lower_right_quarter": {"x": 66, "y": 80}, "right_eyebrow_lower_left_corner": {"x": 108, "y": 85}, "left_eye_center": {"x": 63, "y": 90}, "mouth_lower_lip_left_contour3": {"x": 79, "y": 163}, "left_eye_lower_right_quarter": {"x": 67, "y": 95}, "nose_left_contour5": {"x": 83, "y": 139}, "mouth_upper_lip_left_contour3": {"x": 69, "y": 144}, "right_eyebrow_lower_right_quarter": {"x": 138, "y": 77}, "contour_right13": {"x": 123, "y": 175}, "nose_right_contour4": {"x": 105, "y": 137}, "contour_left2": {"x": 34, "y": 90}, "mouth_upper_lip_left_contour1": {"x": 86, "y": 146}, "right_eyebrow_upper_left_quarter": {"x": 116, "y": 75}, "mouth_upper_lip_right_contour4": {"x": 107, "y": 147}, "contour_right10": {"x": 140, "y": 156}, "nose_bridge1": {"x": 91, "y": 94}, "contour_right2": {"x": 160, "y": 93}, "left_eye_pupil": {"x": 63, "y": 90}, "contour_right11": {"x": 135, "y": 163}, "left_eye_upper_left_quarter": {"x": 56, "y": 86}, "contour_right6": {"x": 155, "y": 126}, "left_eye_left_corner": {"x": 51, "y": 88}, "contour_left6": {"x": 36, "y": 122}, "nose_left_contour4": {"x": 76, "y": 137}, "mouth_upper_lip_top": {"x": 92, "y": 147}, "right_eyebrow_upper_right_quarter": {"x": 138, "y": 71}, "left_eyebrow_lower_middle": {"x": 58, "y": 77}, "mouth_upper_lip_left_contour2": {"x": 75, "y": 145}, "left_eye_right_corner": {"x": 73, "y": 94}, "nose_bridge2": {"x": 91, "y": 108}, "right_eyebrow_upper_left_corner": {"x": 107, "y": 81}, "contour_left8": {"x": 41, "y": 138}, "nose_tip": {"x": 91, "y": 136}, "left_eyebrow_lower_left_quarter": {"x": 50, "y": 76}, "contour_right16": {"x": 102, "y": 190}, "left_eyebrow_left_corner": {"x": 43, "y": 74}, "contour_left5": {"x": 35, "y": 114}, "contour_left3": {"x": 34, "y": 98}, "nose_right_contour3": {"x": 111, "y": 131}, "right_eye_top": {"x": 122, "y": 85}, "contour_right1": {"x": 161, "y": 84}, "nose_middle_contour": {"x": 91, "y": 143}, "contour_right7": {"x": 153, "y": 134}, "left_eye_bottom": {"x": 61, "y": 94}, "right_eye_upper_right_quarter": {"x": 130, "y": 86}, "mouth_upper_lip_right_contour3": {"x": 119, "y": 145}, "mouth_upper_lip_right_contour1": {"x": 97, "y": 146}, "contour_left4": {"x": 34, "y": 106}, "left_eyebrow_upper_left_quarter": {"x": 51, "y": 70}, "left_eye_top": {"x": 63, "y": 86}, "right_eye_upper_left_quarter": {"x": 115, "y": 89}, "right_eye_pupil": {"x": 122, "y": 91}, "nose_left_contour2": {"x": 76, "y": 122}, "nose_left_contour1": {"x": 81, "y": 96}, "contour_right12": {"x": 129, "y": 169}, "mouth_lower_lip_right_contour2": {"x": 116, "y": 154}, "contour_left14": {"x": 69, "y": 179}, "contour_right3": {"x": 160, "y": 101}, "contour_left15": {"x": 75, "y": 185}, "contour_right14": {"x": 117, "y": 182}, "right_eyebrow_lower_left_quarter": {"x": 118, "y": 81}, "nose_right_contour2": {"x": 106, "y": 122}, "contour_right5": {"x": 157, "y": 118}, "mouth_lower_lip_bottom": {"x": 92, "y": 167}, "left_eye_upper_right_quarter": {"x": 69, "y": 89}, "contour_right15": {"x": 110, "y": 187}, "contour_left7": {"x": 38, "y": 130}, "mouth_lower_lip_left_contour1": {"x": 77, "y": 154}, "contour_chin": {"x": 92, "y": 191}, "right_eye_left_corner": {"x": 110, "y": 96}, "mouth_upper_lip_left_contour4": {"x": 78, "y": 147}, "nose_right_contour5": {"x": 99, "y": 139}, "contour_left13": {"x": 64, "y": 172}, "mouth_upper_lip_right_contour2": {"x": 110, "y": 145}, "contour_right9": {"x": 145, "y": 149}, "contour_left1": {"x": 34, "y": 81}}}], "request_id": "1526313401,f9fae0a9-1204-4005-9017-3db4bcfbf105", "time_used": 193};

// 基本色
var baseColor = "#0f0",
    selectedColor = "#f00";
var allFeaturesHandle = [];

// svg 矢量图
var pixSvg = document.getElementById("pixSvg");
var SVG_NS = 'http://www.w3.org/2000/svg';

// 特征点的集成
var leftEye = [
    "left_eye_bottom",
    "left_eye_center",
    "left_eye_left_corner",
    "left_eye_lower_left_quarter",
    "left_eye_lower_right_quarter",
    // "left_eye_pupil",
    "left_eye_right_corner",
    "left_eye_top",
    "left_eye_upper_left_quarter",
    "left_eye_upper_right_quarter"
];
var rightEye = [
    "right_eye_bottom",
    "right_eye_center",
    "right_eye_left_corner",
    "right_eye_lower_left_quarter",
    "right_eye_lower_right_quarter",
    // "right_eye_pupil",
    "right_eye_right_corner",
    "right_eye_top",
    "right_eye_upper_left_quarter",
    "right_eye_upper_right_quarter"
];
var leftEyeBrow = [
    "left_eyebrow_left_corner",
    "left_eyebrow_upper_left_quarter",
    "left_eyebrow_upper_middle",
    "left_eyebrow_upper_right_quarter",
    "left_eyebrow_upper_right_corner",
    "left_eyebrow_lower_left_quarter",
    "left_eyebrow_lower_middle",
    "left_eyebrow_lower_right_quarter",
    "left_eyebrow_lower_right_corner"
];
var rightEyeBrow = [
    "right_eyebrow_right_corner",
    "right_eyebrow_upper_right_quarter",
    "right_eyebrow_upper_middle",
    "right_eyebrow_upper_left_quarter",
    "right_eyebrow_upper_left_corner",
    "right_eyebrow_lower_right_quarter",
    "right_eyebrow_lower_middle",
    "right_eyebrow_lower_left_quarter",
    "right_eyebrow_lower_left_corner"
];
var mouth = [
    "mouth_left_corner",
    "mouth_upper_lip_left_contour3",
    "mouth_upper_lip_left_contour4", // "mouth_lower_lip_left_contour1",
    "mouth_lower_lip_top",
    "mouth_upper_lip_right_contour4", // "mouth_lower_lip_right_contour1",
    "mouth_upper_lip_right_contour3",
    "mouth_right_corner",

    "mouth_upper_lip_left_contour2", // top
    "mouth_upper_lip_left_contour1",
    "mouth_upper_lip_top",
    "mouth_upper_lip_right_contour1",
    "mouth_upper_lip_right_contour2",

    "mouth_lower_lip_left_contour2", // bottom
    "mouth_lower_lip_left_contour3",
    "mouth_lower_lip_bottom",
    "mouth_lower_lip_right_contour3",
    "mouth_lower_lip_right_contour2"
];

// iterator variable
var i;

/***************************************************
 * js 动态生成控制面板
 * @type {Array}
 ***************************************************/

var border_panel_1 = '<div class="form-group border_panel">\
    <label class="control-label">';
var border_panel_2 = '</label>\
    <div class="row">\
    <div class="col-md-6 col-sm-6 col-xs-12">\
    <div>\
    <span class="inline_block span_left fz_12">左</span>\
    <span class="inline_block span_right fz_12">右</span>\
    </div>\
    <input type="range" min="-50" max="50" value="0" class="contour_chin form-control"/>\
    </div>\
    <div class="col-md-6 col-sm-6 col-xs-12">\
    <div>\
    <span class="inline_block span_left fz_12">上</span>\
    <span class="inline_block span_right fz_12">下</span>\
    </div>\
    <input type="range" min="-50" max="50" value="0" class="contour_chin form-control"/>\
    </div>\
    </div>\
    </div>';

function addBorderPanel() {
    // contour_chin
    $("#contour").html("");
    $("#contour").append(border_panel_1 + "contour_chin" + border_panel_2);
    // var panel =
}


/***************************************************
 * 获取所有必要的特征点名称
 * @type {Array}
 ***************************************************/

// 所有关键点
var all_features = [];
// contour chin
all_features.push("contour_chin");
// left contour
for ( i=1; i<=16; i++ ) {
    all_features.push("contour_left" + i);
}
// right contour
for ( i=1; i<=16; i++ ) {
    all_features.push("contour_right" + i);
}
// left eye brow
all_features = all_features.concat(leftEyeBrow);
// right eye brow
all_features = all_features.concat(rightEyeBrow);
// left eye
all_features = all_features.concat(leftEye);
// right eye
all_features = all_features.concat(rightEye);
// nose middle contour
all_features.push("nose_middle_contour");
// left nose contour
for ( i=1; i<=5; i++ ) {
    all_features.push("nose_left_contour" + i);
}
// right nose contour
for ( i=1; i<=5; i++ ) {
    all_features.push("nose_right_contour" + i);
}
// nose bridge
for ( i=1; i<=3; i++ ) {
    all_features.push("nose_bridge" + i);
}
// nose tip
all_features.push("nose_tip");
// mouse
all_features = all_features.concat(mouth);



// 默认男性模板
testJson = manJson;
var imgArea = document.getElementById("imgArea");
var landmark = testJson["faces"][0]["landmark"];
drawAllFeatures();
addEvents();
mouseEvent();
changeEvent();


// model input 改变事件
$(".model_type").change(function(){
    var value = $(this).val();
    if ( value == 0 ) {
        imgArea.setAttribute("src", "./pictures/aobama.jpg");
        testJson = manJson;
        landmark = testJson["faces"][0]["landmark"];
        drawAllFeatures();
        addEvents();
        mouseEvent();
        changeEvent();
    } else {
        imgArea.setAttribute("src", "./pictures/woman.jpg");
        testJson = womanJson;
        landmark = testJson["faces"][0]["landmark"];
        drawAllFeatures();
        addEvents();
        mouseEvent();
        changeEvent();
    }
});

// 点击提交按钮上传文件事件
var submit = document.getElementById("submit");
submit.onclick = function() {
    // 数据封装
    var file = document.getElementById("file").files[0];
    console.log(file.name);
    var formdata = new FormData();
    formdata.append("img", file);
    // ajax 发送请求
    $.ajax({
        url: "http://localhost:8000/api/get_base_features/",
        type: "POST",
        processData: false,
        contentType: false,
        data: formdata,
        dataType: "json",
        success: function(data) {
            // console.log(data);
            // data = eval(data);
            console.log(data);
        },
        error: function(jqXHR, textStatus, errorThrown) {
            console.log(errorThrown);
            console.log("error");
        }
    });
};





/***************************************************
 * 绘制关键点
 * @type {string}
 ***************************************************/

// 所有的features所绘制的点的handle

function drawAllFeatures() {
    clearAllFeatures();
    for ( i=0; i<all_features.length; i++ ) {
        drawPix(landmark[all_features[i]]["x"], landmark[all_features[i]]["y"], baseColor, allFeaturesHandle, all_features[i]);
    }
}

function clearAllFeatures() {
    pixSvg.setAttribute("width", imgArea.width);
    pixSvg.setAttribute("height", imgArea.height);
    allFeaturesHandle = [];
    pixSvg.innerHTML  = "";
}



/***************************************************
 * 所有handle的事件
 * @type {string}
 ***************************************************/

function addEvents() {

    // // 所有handle的mousedown的标志
    // var all_features_flags = [];
    // for (var i = 0; i < all_features.length; i++) {
    //     all_features_flags[i] = [];
    //     all_features_flags[i]['flag'] = false;
    //     all_features_flags[i]['x'] = 0;
    //     all_features_flags[i]['y'] = 0;
    // }


    allFeaturesHandle.forEach(function (current, index, arr) {
        // mouseover
        (function (i) {
            allFeaturesHandle[i].onmouseover = function () {
                this.setAttribute("r", 3);
                this.setAttribute("fill", selectedColor);
            }
        })(index);
        // mouseout
        (function (i) {
            allFeaturesHandle[i].onmouseout = function () {
                this.setAttribute("r", 2);
                this.setAttribute("fill", baseColor);
                // all_features_flags[i]["flag"] = false;
                // all_features_flags[i]['x'] = 0;
                // all_features_flags[i]['y'] = 0;
            }
        })(index);
        // // mousedown
        // (function (i) {
        //     allFeaturesHandle[i].onmousedown = function (event) {
        //         var coordinate = getMouseCoordinate(event);
        //         console.log("x: " + coordinate.x + "\ty: " + coordinate.y);
        //         all_features_flags[i]["flag"] = true;
        //         all_features_flags[i]['x'] = coordinate.x;
        //         all_features_flags[i]['y'] = coordinate.y;
        //     }
        // })(index);
        // // mousemove
        // (function (i) {
        //     allFeaturesHandle[i].onmousemove = function (event) {
        //         if (all_features_flags[i]["flag"] == true) {
        //             var coordinate = getMouseCoordinate(event);
        //             var x = parseInt(landmark[all_features[i]]["x"]) + parseInt(coordinate.x) - parseInt(all_features_flags[i]["x"]);
        //             var y = parseInt(landmark[all_features[i]]["y"]) + parseInt(coordinate.y) - parseInt(all_features_flags[i]["y"]);
        //             this.setAttribute("cx", x);
        //             this.setAttribute("cy", y);
        //         }
        //     }
        // })(index);
        // // mouseup
        // (function (i) {
        //     allFeaturesHandle[i].onmouseup = function (event) {
        //         all_features_flags[i]["flag"] = false;
        //         all_features_flags[i]['x'] = 0;
        //         all_features_flags[i]['y'] = 0;
        //     }
        // })(index);
    });
}

// 获取鼠标的坐标
function getMouseCoordinate(event) {
    var e = event || window.event;
    var scrollX = document.documentElement.scrollLeft || document.body.scrollLeft;
    var scrollY = document.documentElement.scrollTop || document.body.scrollTop;
    var x = e.pageX || e.clientX + scrollX;
    var y = e.pageY || e.clientY + scrollY;
    return {"x": x, "y": y};
}


// 绘制特征点
function drawPix(x, y, color, arr, id) {
    var circle = document.createElementNS(SVG_NS, "circle");
    circle.setAttribute("cx", x);
    circle.setAttribute("cy", y);
    circle.setAttribute("r", 2);
    circle.setAttribute("fill", color);
    circle.setAttribute("id", id);
    circle.setAttribute("cursor", "move");
    arr.push(circle);
    pixSvg.appendChild(circle);
}


/***************************************************
 * 鼠标事件
 * @type {any}
 ***************************************************/
function mouseEvent() {
    var all_features_panel = document.getElementsByClassName("border_panel");
    var all_features_panel_arr = Object.keys(all_features_panel).map(function (key) {
        return all_features_panel[key];
    });
    all_features_panel_arr.forEach(function (current, index, arr) {
        // 鼠标进入区域事件
        (function (i) {
            current.onmouseover = function () {
                allFeaturesHandle[i].setAttribute("fill", selectedColor);
            };
        })(index);
        // 鼠标离开区域事件
        (function (i) {
            current.onmouseout = function () {
                allFeaturesHandle[i].setAttribute("fill", baseColor);
            };
        })(index);
    });
}

/***************************************************
 * 获取所有 input range
 ***************************************************/
// var all_x_range = [],
//     all_y_range = [];
// for ( i=0; i<all_features.length; i++ ) {
//     all_x_range.push(document.getElementById(all_features[i] + "_x"));
//     all_y_range.push(document.getElementById(all_features[i] + "_y"));
// }


/***************************************************
 * 特征点改变事件
 ***************************************************/

function changeEvent() {



    var input_range = document.getElementsByClassName("panel-body")[0].getElementsByTagName("input");
    var input_range_arr = Object.keys(input_range).map(function (key) {
        return input_range[key];
    });
    console.log(input_range_arr);
    input_range_arr.forEach(function (current, index, arr) {
        if (index % 2 == 0) { // x 值 改变
            (function (i) {
                var id = Math.floor(index / 2);
                input_range_arr[i].oninput = function () {
                    console.log(i);
                    var value = parseInt(this.value);
                    var cx = parseInt(landmark[all_features[id]]["x"]) + value * 0.4;
                    allFeaturesHandle[id].setAttribute("cx", cx);
                }
            })(index);
        } else { // y 值 改变
            (function (i) {
                var id = Math.floor(index / 2);
                input_range_arr[i].oninput = function () {
                    console.log(i);
                    var value = parseInt(this.value);
                    var cy = parseInt(landmark[all_features[id]]["y"]) + value * 0.4;
                    allFeaturesHandle[id].setAttribute("cy", cy);
                }
            })(index);
        }
    });

}


